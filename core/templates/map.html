{% extends 'base.html' %}

{% load static %}
{% load i18n %}

{% block stylesheets %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'leaflet/leaflet.css' %}" />
{% endblock %}

{% block title %}{% trans 'Map' %}{% endblock %}

{% block body %}
    {{ block.super }}
    <div class="container-fluid full-height">
        <div class="row full-height">
            <div class="col-sm-12 full-height">
                <div id="map" class="full-height"></div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ block.super }}
    <script src="{% static 'leaflet/leaflet.js' %}"></script>
    <script>
        $(document).ready(function() {
            var map = L.map('map').setView([44.836517, -0.583233], 13);

            L.tileLayer('https://{s}.{{ OSM_TILE_SERVER }}/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery Â© <a href="http://openstreetmap.org">OpenStreetMap</a>',
            }).addTo(map);

            {% for profile in profiles %}
                var customIcon = L.icon({
                    iconUrl: {% if profile.gravatar %}
                                 'http://fr.gravatar.com/avatar/{{ profile.gravatar }}?s=80',
                             {% else %}
                                 {# set rand = random(2)+1 #}
                                 '{% static 'ressources/logo/berry_punch_1.png' %}',
                             {% endif %}
                    iconSize: [80, 80],
                    iconAnchor: [40, 80],
                    popupAnchor: [0, -80]
                });
                L.marker(
                    [{{ profile.addressLatitude }}, {{profile.addressLongitude }}],{
                        icon: customIcon
                    }
                ).addTo(map).bindPopup("{{ profile.user.username }}").openPopup();
            {% endfor %}

            var popup = L.popup();
        });
    </script>
{% endblock %}
